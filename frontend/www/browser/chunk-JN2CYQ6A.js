import{a as _,b as Z}from"./chunk-AVQ2NC4B.js";import"./chunk-SAQZAJ65.js";import{$ as O,B as S,Ea as K,Fa as Q,G as a,H as f,I,Ia as U,Ja as W,L as k,La as X,M as w,Ma as Y,P,T,Z as l,_ as x,a as E,aa as B,ba as m,ca as D,da as N,ea as R,f as F,ga as V,ha as A,j as s,ka as G,ma as M,na as $,p as d,pa as q,q as b,qa as L,ra as j,s as c,sa as H,t as p,w as h,wa as z,x as n,xa as J,y as o,z as g}from"./chunk-3L42HEHQ.js";import"./chunk-CLAHLS7V.js";import"./chunk-7OOC4MCY.js";import"./chunk-4G6E6OF5.js";import"./chunk-HY2EOBI2.js";import"./chunk-SZW6GDO7.js";import"./chunk-6OREKIDA.js";import"./chunk-4WFVMWDK.js";import"./chunk-K7C27B2F.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-DF3GZESY.js";import"./chunk-PVMEIX5M.js";import"./chunk-42C7ZIID.js";import{a as u,e as v}from"./chunk-JHI3MBHO.js";var ee=r=>u({start_time:"12:00",duration:10,repeat:"every_day",active:!0,relay_position:1},r);function te(r,y){r&1&&(n(0,"div",7),a(1," Start time has wrong format. "),o())}function ie(r,y){r&1&&(n(0,"div",7),a(1," Please enter a positive integer. "),o())}function ne(r,y){r&1&&(n(0,"div",7),a(1," Please enter a positive integer. "),o())}var Ee=(()=>{class r{activatedRoute=s(T);scheduleService=s(Z);cdr=s(P);pickerCtrl=s(U);toastController=s(W);navController=s(A);id=null;addEditForm;repeatOptions;hourOptions;minuteOptions;cancelButton={text:"Cancel",role:"cancel"};repeatValues=["every_day","weekdays","weekends","monday","tuesday","wednesday","thursday","friday","saturday","sunday"];displayStringPipe;constructor(){this.displayStringPipe=new _,this.repeatOptions=this.repeatValues.map(t=>({text:this.displayStringPipe.transform(t),value:t})),this.hourOptions=[...Array(24)].map((t,i)=>{let e=String(i).padStart(2,"0");return{text:e,value:e}}),this.minuteOptions=[...Array(60)].map((t,i)=>{let e=String(i).padStart(2,"0");return{text:e,value:e}}),this.addEditForm=new B({start_time:new m("",[l.required,l.pattern("^[0-9]{1,2}:[0-9]{1,2}$")]),duration:new m(1,[l.min(1),l.required,l.pattern("^[0-9]+$")]),repeat:new m("every_day",l.required),active:new m(!0,l.required),relay_position:new m(1,[l.min(1),l.pattern("^[0-9]+$")])})}ngOnInit(){this.id=parseInt(this.activatedRoute.snapshot.paramMap.get("id")),E(ee()).pipe(F(t=>this.id?this.scheduleService.getSchedule(this.id):E(t))).subscribe(t=>{this.addEditForm.patchValue(t),this.cdr.detectChanges()})}openRepeatPicker(){return v(this,null,function*(){let t=yield this.pickerCtrl.create({columns:[{name:"repeat",options:this.repeatOptions}],buttons:[u({},this.cancelButton),{text:"Confirm",handler:i=>{this.addEditForm.patchValue({repeat:i.repeat.value}),this.cdr.detectChanges()}}]});(yield t.getColumn("repeat")).selectedIndex=this.repeatOptions.map(({value:i})=>i).findIndex(i=>i===this.addEditForm?.controls?.repeat?.value),yield t.present()})}openStartTimePicker(){return v(this,null,function*(){let t=yield this.pickerCtrl.create({columns:[{name:"hour",options:this.hourOptions},{name:"minute",options:this.minuteOptions}],buttons:[u({},this.cancelButton),{text:"Confirm",handler:e=>{this.addEditForm.patchValue({start_time:`${e.hour.value}:${e.minute.value}`}),this.cdr.detectChanges()}}]}),i=this.addEditForm?.controls?.start_time?.value?.match(/^([0-9]{1,2}):([0-9]{1,2})/);i&&((yield t.getColumn("hour")).selectedIndex=parseInt(i[1]),(yield t.getColumn("minute")).selectedIndex=parseInt(i[2])),yield t.present()})}onSubmit(){if(this.addEditForm.status==="VALID"){let t;this.id?t=this.scheduleService.updateSchedule(this.id,this.addEditForm.value):t=this.scheduleService.createSchedule(this.addEditForm.value),t.subscribe(()=>{this.navController.navigateBack(["schedules"]).catch(()=>{})})}else this.toastController.create({message:"Please check your input and try again",duration:3e3,color:"danger",position:"bottom"}).then(t=>t.present()).catch(()=>{})}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=b({type:r,selectors:[["app-schedule-edit"]],decls:33,vars:11,consts:[[3,"translucent"],["slot","start"],["defaultHref","/"],[3,"fullscreen"],[3,"ngSubmit","formGroup"],[3,"click"],[1,"ion-text-right"],[1,"error-msg","ion-padding-start","ion-padding-end"],["type","number","step","1","label","Duration:","formControlName","duration",1,"ion-text-right"],["type","number","step","1","label","Relay position:","formControlName","relay_position",1,"ion-text-right"],["justify","space-between","formControlName","active"],["expand","block","type","submit","color","danger"]],template:function(i,e){i&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),g(3,"ion-back-button",2),o(),n(4,"ion-title"),a(5),o()()(),n(6,"ion-content",3)(7,"form",4),S("ngSubmit",function(){return e.onSubmit()}),n(8,"ion-list")(9,"ion-item-group")(10,"ion-item",5),S("click",function(){return e.openStartTimePicker()}),n(11,"ion-label"),a(12,"Start time:"),o(),n(13,"ion-label",6),a(14),o()(),c(15,te,2,0,"div",7),n(16,"ion-item"),g(17,"ion-input",8),o(),c(18,ie,2,0,"div",7),n(19,"ion-item",5),S("click",function(){return e.openRepeatPicker()}),n(20,"ion-label"),a(21,"Repeat:"),o(),n(22,"ion-label",6),a(23),k(24,"displayString"),o()(),n(25,"ion-item"),g(26,"ion-input",9),o(),c(27,ne,2,0,"div",7),n(28,"ion-item")(29,"ion-toggle",10),a(30,"Active"),o()()()(),n(31,"ion-button",11),a(32,"SAVE"),o()()()),i&2&&(h("translucent",!0),d(5),I("",e.id?"Edit":"Create"," schedule"),d(),h("fullscreen",!0),d(),h("formGroup",e.addEditForm),d(7),f(e.addEditForm==null||e.addEditForm.controls==null||e.addEditForm.controls.start_time==null?null:e.addEditForm.controls.start_time.value),d(),p(!(e.addEditForm.controls==null||e.addEditForm.controls.start_time==null)&&e.addEditForm.controls.start_time.errors?15:-1),d(3),p(!(e.addEditForm.controls==null||e.addEditForm.controls.duration==null)&&e.addEditForm.controls.duration.errors?18:-1),d(5),f(w(24,9,e.addEditForm==null||e.addEditForm.controls==null||e.addEditForm.controls.repeat==null?null:e.addEditForm.controls.repeat.value)),d(4),p(!(e.addEditForm.controls==null||e.addEditForm.controls.relay_position==null)&&e.addEditForm.controls.relay_position.errors?27:-1))},dependencies:[V,D,x,O,R,N,L,Q,$,G,K,q,J,H,j,z,M,X,Y,_],styles:[".error-msg[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:12px}"],changeDetection:0})}return r})();export{Ee as ScheduleEditPage};
